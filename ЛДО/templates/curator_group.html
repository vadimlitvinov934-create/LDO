{% extends "base.html" %}
{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {{ group }}{% endblock %}

{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
{% endblock %}

{% block content %}

<style>
  :root {
    --font-main: 'Inter', sans-serif;
    --bg-page: #f3f4f6;
    --bg-card: #ffffff;
    --text-primary: #111827;
    --text-secondary: #6b7280;
    --border-color: #e5e7eb;
    
    --primary-color: #4f46e5;
    --primary-hover: #4338ca;
    --excel-color: #10b981; /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è Excel */
    --excel-hover: #059669;

    --radius-md: 12px;
    --shadow-sm: 0 1px 2px 0 rgba(0,0,0,0.05);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
  }

  body { background: var(--bg-page); color: var(--text-primary); font-family: var(--font-main); }

  /* --- –ó–ê–ì–û–õ–û–í–û–ö –°–¢–†–ê–ù–ò–¶–´ --- */
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
    flex-wrap: wrap;
    gap: 16px;
  }
  .page-title h1 { font-size: 24px; font-weight: 700; margin: 0; }
  .page-title .subtitle { color: var(--text-secondary); font-size: 14px; margin-top: 4px; }

  /* –ö–Ω–æ–ø–∫–∞ Excel */
  .btn-excel {
    background-color: var(--excel-color);
    color: white;
    text-decoration: none;
    padding: 8px 16px;
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 14px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: 0.2s;
    border: none;
    box-shadow: var(--shadow-sm);
  }
  .btn-excel:hover { background-color: var(--excel-hover); transform: translateY(-1px); color: white; }
  .btn-excel i { font-size: 16px; }

  /* --- –ü–ê–ù–ï–õ–¨ –§–ò–õ–¨–¢–†–û–í --- */
  .filters-card {
    background: var(--bg-card);
    border-radius: var(--radius-md);
    padding: 20px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    margin-bottom: 24px;
    display: flex;
    flex-wrap: wrap;
    align-items: flex-end;
    gap: 16px;
  }

  .form-group { display: flex; flex-direction: column; gap: 6px; }
  .form-label { font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; }
  
  .form-control {
    padding: 8px 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 14px;
    font-family: inherit;
    background: #fff;
    min-width: 140px;
  }
  .form-control:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }

  .btn-show {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 9px 20px; /* –ß—É—Ç—å –±–æ–ª—å—à–µ –ø–∞–¥–¥–∏–Ω–≥ —á—Ç–æ–±—ã –≤—ã—Ä–æ–≤–Ω—è—Ç—å –≤—ã—Å–æ—Ç—É —Å –∏–Ω–ø—É—Ç–∞–º–∏ */
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s;
  }
  .btn-show:hover { background: var(--primary-hover); }

  .period-badge {
    margin-left: auto; /* –û—Ç–æ–¥–≤–∏–≥–∞–µ—Ç –≤–ø—Ä–∞–≤–æ */
    background: #f3f4f6;
    color: var(--text-secondary);
    padding: 6px 12px;
    border-radius: 99px;
    font-size: 13px;
    font-weight: 500;
    border: 1px solid var(--border-color);
  }
  @media (max-width: 768px) { .period-badge { margin-left: 0; width: 100%; text-align: center; } }

  /* --- –¢–ê–ë–õ–ò–¶–ê --- */
  .table-card {
    background: var(--bg-card);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
    overflow: hidden;
  }

  .table-responsive {
    overflow-x: auto;
    scrollbar-width: thin;
  }

  .stats-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    white-space: nowrap;
  }

  /* –®–∞–ø–∫–∞ —Ç–∞–±–ª–∏—Ü—ã */
  .stats-table thead th {
    background: #f9fafb;
    color: var(--text-secondary);
    font-weight: 600;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    padding: 10px 16px;
    border-bottom: 1px solid var(--border-color);
    text-align: center;
    vertical-align: middle;
  }
  /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –≤ —à–∞–ø–∫–µ */
  .stats-table thead th { border-right: 1px solid #e5e7eb; }
  .stats-table thead th:last-child { border-right: none; }

  /* –¢–µ–ª–æ —Ç–∞–±–ª–∏—Ü—ã */
  .stats-table td {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-primary);
    text-align: center;
  }
  .stats-table td:nth-child(2) { text-align: left; font-weight: 500; } /* –ò–º—è —Å–ª–µ–≤–∞ */
  
  .stats-table tbody tr:hover { background: #f8fafc; }

  /* –ö–æ–ª–æ–Ω–∫–∞ "–í—Å–µ–≥–æ" */
  .col-total { font-weight: 700; color: var(--primary-color); background: #fbfbfe; }
  
  /* –ö–æ–ª–æ–Ω–∫–∞ "–ù–µ—É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–∞—è" */
  .col-danger { color: #dc2626; background: #fef2f2; font-weight: 600; }

  /* –°—Ç—Ä–æ–∫–∞ –ò—Ç–æ–≥–æ */
  .tr-summary td {
    background: #eff6ff; /* –°–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω */
    font-weight: 700;
    border-top: 2px solid #dbeafe;
    color: #1e3a8a;
  }

  .empty-state { padding: 40px; text-align: center; color: var(--text-secondary); }

</style>

<div class="page-header">
  <div class="page-title">
    <h1>–ì—Ä—É–ø–ø–∞ {{ group }}</h1>
    <div class="subtitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</div>
  </div>
  
  <a class="btn-excel" href="{{ url_for('head_bp.group_export_excel', g=group, day=day.isoformat(), mode=mode) }}">
    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
    </svg>
    –°–∫–∞—á–∞—Ç—å Excel
  </a>
</div>

<form class="filters-card" method="get" action="{{ url_for('curator_bp.group_view') }}">
  <input type="hidden" name="g" value="{{ group }}">

  <div class="form-group">
    <label class="form-label">–î–∞—Ç–∞ –æ—Ç—Å—á–µ—Ç–∞</label>
    <input type="date" name="day" value="{{ day.isoformat() }}" class="form-control">
  </div>

  <div class="form-group">
    <label class="form-label">–ü–µ—Ä–∏–æ–¥</label>
    <select name="mode" class="form-control">
      <option value="day" {% if mode == 'day' %}selected{% endif %}>–î–µ–Ω—å</option>
      <option value="month" {% if mode == 'month' %}selected{% endif %}>–ú–µ—Å—è—Ü</option>
      <option value="semester" {% if mode == 'semester' %}selected{% endif %}>–°–µ–º–µ—Å—Ç—Ä</option>
    </select>
  </div>

  <button type="submit" class="btn-show">–ü–æ–∫–∞–∑–∞—Ç—å</button>

  <div class="period-badge">
    –ü–µ—Ä–∏–æ–¥: {{ start.strftime('%d.%m.%Y') }} ‚Äî {{ end.strftime('%d.%m.%Y') }}
  </div>
</form>

<div class="table-card">
  {% if detail.rows|length == 0 %}
    <div class="empty-state">
      <div style="font-size: 40px; margin-bottom: 10px;">üìä</div>
      –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.
    </div>
  {% else %}
    <div class="table-responsive">
      <table class="stats-table">
        <thead>
          <tr>
            <th rowspan="2" style="width: 50px;">‚Ññ</th>
            <th rowspan="2" style="text-align: left;">–°—Ç—É–¥–µ–Ω—Ç</th>
            <th rowspan="2" class="col-total" style="width: 100px;">–í—Å–µ–≥–æ<br>(—á–∞—Å–æ–≤)</th>
            <th colspan="5" style="border-bottom: 0;">–ü—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–ø—É—Å–∫–æ–≤</th>
            <th rowspan="2" style="width: 80px;">%</th>
          </tr>
          <tr>
            <th>–ó–∞—è–≤–ª–µ–Ω–∏–µ</th>
            <th>–ë–æ–ª–µ–∑–Ω—å</th>
            <th>–°–æ—Ä–µ–≤–Ω.</th>
            <th>–î—Ä—É–≥–æ–µ</th>
            <th class="col-danger">–ù–µ—É–≤–∞–∂.</th>
          </tr>
        </thead>
        <tbody>
          {% for row in detail.rows %}
          <tr>
            <td>{{ row.num }}</td>
            <td>{{ row.full_name }}</td>
            <td class="col-total">{{ row.total }}</td>
            
            <td>{% if row.statement > 0 %}{{ row.statement }}{% else %}<span style="color:#d1d5db">‚Äî</span>{% endif %}</td>
            <td>{% if row.sick > 0 %}{{ row.sick }}{% else %}<span style="color:#d1d5db">‚Äî</span>{% endif %}</td>
            <td>{% if row.competition > 0 %}{{ row.competition }}{% else %}<span style="color:#d1d5db">‚Äî</span>{% endif %}</td>
            <td>{% if row.other > 0 %}{{ row.other }}{% else %}<span style="color:#d1d5db">‚Äî</span>{% endif %}</td>
            
            <td class="col-danger">{% if row.unexcused > 0 %}{{ row.unexcused }}{% else %}0{% endif %}</td>
            
            <td>
              {% set p = row.pct %}
              {% if p < 50 %}
                <span style="color: #dc2626; font-weight:700;">{{ '%.1f'|format(p) }}</span>
              {% elif p < 80 %}
                <span style="color: #d97706; font-weight:600;">{{ '%.1f'|format(p) }}</span>
              {% else %}
                <span style="color: #059669; font-weight:600;">{{ '%.1f'|format(p) }}</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
          
          <tr class="tr-summary">
            <td colspan="8" style="text-align: right; padding-right: 20px;">–û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –≥—Ä—É–ø–ø—ã:</td>
            <td>{{ '%.2f'|format(detail.group_pct) }}%</td>
          </tr>
        </tbody>
      </table>
    </div>
  {% endif %}
</div>

{% endblock %}